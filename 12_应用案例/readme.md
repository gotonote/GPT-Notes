# åŒ»ç–—å¥åº· AI åº”ç”¨

## æ¦‚è¿°

åŒ»ç–—å¥åº·æ˜¯ LLM åº”ç”¨çš„é‡è¦é¢†åŸŸã€‚æœ¬ç« å°†ä»‹ç»å¦‚ä½•æ„å»ºåŒ»ç–—å¥åº· AI ç³»ç»Ÿï¼ŒåŒ…æ‹¬å¥åº·å’¨è¯¢ã€ç—‡çŠ¶åˆ†æã€è¯ç‰©åŠ©æ‰‹ã€åŒ»å­¦çŸ¥è¯†é—®ç­”ç­‰åº”ç”¨åœºæ™¯ï¼ŒåŒæ—¶å¼ºè°ƒåŒ»ç–— AI çš„åˆè§„æ€§å’Œå®‰å…¨æ€§è¦æ±‚ã€‚

## 1. åŒ»ç–— AI ç³»ç»Ÿæ¶æ„

### 1.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŒ»ç–—å¥åº· AI ç³»ç»Ÿæ¶æ„                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      ç”¨æˆ·äº¤äº’å±‚                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  å¥åº·App  â”‚ â”‚  å¾®ä¿¡å°ç¨‹åºâ”‚ â”‚  Webç«¯   â”‚ â”‚  è¯­éŸ³åŠ©æ‰‹ â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      å®‰å…¨å±‚                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  èº«ä»½è®¤è¯    â”‚ â”‚  éšç§ä¿æŠ¤    â”‚ â”‚  é£é™©æç¤º    â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      ä¸šåŠ¡å±‚                              â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚    â”‚
â”‚  â”‚  â”‚ å¥åº·å’¨è¯¢   â”‚ â”‚ ç—‡çŠ¶åˆ†æ   â”‚ â”‚ è¯ç‰©åŠ©æ‰‹   â”‚        â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚    â”‚
â”‚  â”‚  â”‚ åŒ»å­¦çŸ¥è¯†åº“ â”‚ â”‚ ç”¨è¯æé†’   â”‚ â”‚ é¢„çº¦å¯¼è¯Š   â”‚        â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      æ¨¡å‹å±‚                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚    â”‚
â”‚  â”‚  â”‚  åŒ»ç–— LLM  â”‚ â”‚  Embedding â”‚ â”‚  RAG æ£€ç´¢  â”‚        â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      æ•°æ®å±‚                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚    â”‚
â”‚  â”‚  â”‚åŒ»å­¦æ–‡çŒ® â”‚ â”‚ è¯å“åº“  â”‚ â”‚ ç—…å†åº“  â”‚ â”‚å¥åº·æ¡£æ¡ˆ â”‚         â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 åˆè§„æ€§è¦æ±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŒ»ç–— AI åˆè§„æ€§è¦æ±‚                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  âš ï¸ é‡è¦å£°æ˜                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  åŒ»ç–— AI ç³»ç»Ÿå¿…é¡»éµå®ˆä»¥ä¸‹åŸåˆ™ï¼š                                   â”‚
â”‚                                                                 â”‚
â”‚  1. è¾…åŠ©å†³ç­–è€Œéè¯Šæ–­                                             â”‚
â”‚     AI æä¾›çš„æ˜¯å¥åº·ä¿¡æ¯å‚è€ƒï¼Œä¸èƒ½æ›¿ä»£åŒ»ç”Ÿè¯Šæ–­                     â”‚
â”‚                                                                 â”‚
â”‚  2. æ˜ç¡®å…è´£å£°æ˜                                                â”‚
â”‚     å§‹ç»ˆå‘ŠçŸ¥ç”¨æˆ· AI ä¸èƒ½æ›¿ä»£ä¸“ä¸šåŒ»ç–—å»ºè®®                          â”‚
â”‚                                                                 â”‚
â”‚  3. æ•°æ®éšç§ä¿æŠ¤                                                â”‚
â”‚     ç¬¦åˆ HIPAAã€GDPR ç­‰åŒ»ç–—æ•°æ®ä¿æŠ¤æ³•è§„                          â”‚
â”‚                                                                 â”‚
â”‚  4. å®‰å…¨æ€§ä¼˜å…ˆ                                                  â”‚
â”‚     å¯¹æ¶‰åŠç”Ÿå‘½å®‰å…¨çš„å»ºè®®ï¼Œè®¾ç½®äººå·¥å¤æ ¸ç¯èŠ‚                        â”‚
â”‚                                                                 â”‚
â”‚  5. å¯è¿½æº¯æ€§                                                    â”‚
â”‚     è®°å½•æ‰€æœ‰å»ºè®®çš„ç”Ÿæˆè¿‡ç¨‹ï¼Œä¾¿äºå®¡è®¡                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. å¥åº·å’¨è¯¢åŠ©æ‰‹

### 2.1 ç³»ç»Ÿè®¾è®¡

```python
from langchain_openai import ChatOpenAI
from langchain.prompts import ChatPromptTemplate
from langchain.memory import ConversationBufferMemory
from pydantic import BaseModel
from typing import Optional, List
from enum import Enum

class HealthDomain(str, Enum):
    GENERAL = " general_health"
    NUTRITION = "nutrition"
    EXERCISE = "exercise"
    MENTAL = "mental_health"
    SLEEP = "sleep"
    CHRONIC = "chronic_disease"

class HealthConsultant:
    def __init__(self):
        self.llm = ChatOpenAI(model="gpt-4", temperature=0.7)
        
        # ç³»ç»Ÿæç¤ºè¯
        self.system_prompt = """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å¥åº·é¡¾é—®åŠ©æ‰‹ã€‚ä½ çš„èŒè´£æ˜¯ï¼š
        
1. æä¾›åŸºäºè¯æ®çš„å¥åº·ä¿¡æ¯å’Œå»ºè®®
2. å¸®åŠ©ç”¨æˆ·äº†è§£å¥åº·ç”Ÿæ´»æ–¹å¼
3. è§£é‡ŠåŒ»å­¦æœ¯è¯­å’Œæ¦‚å¿µ
4. æé†’ç”¨æˆ·ä½•æ—¶éœ€è¦å¯»æ±‚ä¸“ä¸šåŒ»ç–—å¸®åŠ©

âš ï¸ é‡è¦å£°æ˜ï¼š
- ä½ æä¾›çš„ä»…æ˜¯å¥åº·ä¿¡æ¯å‚è€ƒï¼Œä¸èƒ½æ›¿ä»£åŒ»ç”Ÿè¯Šæ–­
- å¦‚æœç”¨æˆ·æè¿°çš„ç—‡çŠ¶å¯èƒ½ä¸¥é‡ï¼Œè¯·ç«‹å³å»ºè®®å°±åŒ»
- ä¸è¦ä¸ºæ€¥è¯Šæƒ…å†µæä¾›å»ºè®®ï¼Œç«‹åˆ»è®©ç”¨æˆ·æ‹¨æ‰“æ€¥æ•‘ç”µè¯

è¯·ç”¨å‹å¥½ã€ä¸“ä¸šçš„æ–¹å¼å›å¤ã€‚"""

        self.prompt = ChatPromptTemplate.from_messages([
            ("system", self.system_prompt),
            ("placeholder", "{chat_history}"),
            ("human", "{input}")
        ])
        
        self.memory = ConversationBufferMemory(
            memory_key="chat_history",
            return_messages=True
        )
        
        self.chain = self.prompt | self.llm
    
    def chat(self, user_input: str) -> str:
        # è·å–å†å²
        chat_history = self.memory.load_memory_variables({})["chat_history"]
        
        # ç”Ÿæˆå›å¤
        response = self.chain.invoke({
            "input": user_input,
            "chat_history": chat_history
        })
        
        # ä¿å­˜è®°å¿†
        self.memory.save_context(
            {"input": user_input},
            {"output": response.content}
        )
        
        return response.content
    
    def reset(self):
        """é‡ç½®å¯¹è¯"""
        self.memory.clear()

# ä½¿ç”¨
consultant = HealthConsultant()
print(consultant.chat("ä»€ä¹ˆæ˜¯å¥åº·çš„é¥®é£Ÿæ–¹å¼ï¼Ÿ"))
print("-" * 50)
print(consultant.chat("æˆ‘åº”è¯¥å¦‚ä½•å¼€å§‹è¿åŠ¨ï¼Ÿ"))
```

### 2.2 å¸¦å®‰å…¨æ£€æŸ¥çš„å¥åº·å’¨è¯¢

```python
from typing import List, Tuple
import re

class SafeHealthConsultant:
    # å±é™©ä¿¡å·å…³é”®è¯
    DANGER_KEYWORDS = [
        "èƒ¸ç—›", "å‘¼å¸å›°éš¾", "å¤§å‡ºè¡€", "æ„è¯†ä¸æ¸…", 
        "ä¸­æ¯’", "è‡ªæ€", "ä¸¥é‡è¿‡æ•", "ä¼‘å…‹"
    ]
    
    # éœ€è¦å°±åŒ»çš„å…³é”®è¯
    SEE_DOCTOR_KEYWORDS = [
        "å‘çƒ§", "æŒç»­ç–¼ç—›", "ä½“é‡éª¤é™", "å¼‚å¸¸å‡ºè¡€",
        "é•¿æœŸå’³å—½", "å¤´ç—›", "çœ©æ™•", "çš®ç–¹"
    ]
    
    def __init__(self):
        self.consultant = HealthConsultant()
    
    def check_danger(self, message: str) -> Tuple[bool, str]:
        """æ£€æŸ¥æ˜¯å¦æ¶‰åŠç´§æ€¥æƒ…å†µ"""
        message = message.lower()
        
        for keyword in self.DANGER_KEYWORDS:
            if keyword in message:
                return True, self._get_emergency_response(keyword)
        
        return False, ""
    
    def check_see_doctor(self, message: str) -> str:
        """æ£€æŸ¥æ˜¯å¦å»ºè®®å°±åŒ»"""
        for keyword in self.SEE_DOCTOR_KEYWORDS:
            if keyword in message:
                return self._get_see_doctor_suggestion(keyword)
        return ""
    
    def _get_emergency_response(self, keyword: str) -> str:
        return f"""
âš ï¸ ç´§æ€¥æç¤º

æ‚¨æè¿°çš„æƒ…å†µå¯èƒ½æ¶‰åŠç´§æ€¥åŒ»ç–—çŠ¶å†µï¼Œè¯·ç«‹å³ï¼š
1. æ‹¨æ‰“ 120 æ€¥æ•‘ç”µè¯
2. æˆ–å‰å¾€æœ€è¿‘åŒ»é™¢çš„æ€¥è¯Šç§‘

{keyword} å¯èƒ½é¢„ç¤ºä¸¥é‡å¥åº·é—®é¢˜ï¼Œè¯·ä¸è¦å»¶è¿Ÿï¼Œç«‹å³å¯»æ±‚åŒ»ç–—å¸®åŠ©ï¼
"""
    
    def _get_see_doctor_suggestion(self, keyword: str) -> str:
        return f"""
ğŸ’¡ å»ºè®®ï¼šæ‚¨æè¿°çš„æƒ…å†µæ¶‰åŠ {keyword}ï¼Œå»ºè®®æ‚¨ï¼š
- å°½å¿«é¢„çº¦åŒ»ç”Ÿè¿›è¡Œé¢è¯Š
- å¦‚ç—‡çŠ¶æŒç»­æˆ–åŠ é‡ï¼Œç«‹å³å°±åŒ»
- è®°å½•ç—‡çŠ¶å‡ºç°çš„æ—¶é—´ã€é¢‘ç‡å’Œä¼´éšå› ç´ ï¼Œä¾›åŒ»ç”Ÿå‚è€ƒ

æœ¬å»ºè®®ä»…ä¾›å‚è€ƒï¼Œä¸èƒ½æ›¿ä»£ä¸“ä¸šåŒ»ç–—è¯Šæ–­ã€‚"""

    def chat(self, user_input: str) -> str:
        # 1. æ£€æŸ¥ç´§æ€¥æƒ…å†µ
        is_danger, danger_response = self.check_danger(user_input)
        if is_danger:
            return danger_response
        
        # 2. æ­£å¸¸å¥åº·å’¨è¯¢
        response = self.consultant.chat(user_input)
        
        # 3. æ£€æŸ¥æ˜¯å¦éœ€è¦æ·»åŠ å°±åŒ»å»ºè®®
        see_doctor = self.check_see_doctor(user_input)
        if see_doctor:
            response += see_doctor
        
        # 4. æ·»åŠ é€šç”¨å…è´£å£°æ˜
        response += "\n\nâš ï¸ æœ¬å›ç­”ä»…ä¾›å‚è€ƒï¼Œä¸èƒ½æ›¿ä»£ä¸“ä¸šåŒ»ç–—å»ºè®®ã€‚å¦‚æœ‰ç–‘è™‘ï¼Œè¯·å’¨è¯¢åŒ»ç”Ÿã€‚"
        
        return response

# ä½¿ç”¨
safe_consultant = SafeHealthConsultant()

# ç´§æ€¥æƒ…å†µ
print(safe_consultant.chat("æˆ‘çªç„¶èƒ¸å£å¾ˆç—›ï¼Œå‘¼å¸å›°éš¾"))
print("=" * 50)

# æ™®é€šå’¨è¯¢
print(safe_consultant.chat("æ¯å¤©èµ°10000æ­¥å¯¹èº«ä½“å¥½å—ï¼Ÿ"))
```

## 3. ç—‡çŠ¶åˆ†æåŠ©æ‰‹

### 3.1 ç—‡çŠ¶åˆ†æ Chain

```python
from typing import Optional, List, Dict
from pydantic import BaseModel
from enum import Enum

class UrgencyLevel(str, Enum):
    EMERGENCY = "emergency"      # ç«‹å³å°±åŒ»/æ‹¨æ‰“120
    URGENT = "urgent"           # å°½å¿«å°±åŒ»ï¼ˆ24å°æ—¶å†…ï¼‰
    ROUTINE = "routine"         # å¸¸è§„å°±åŒ»
    SELF_CARE = "self_care"    # å¯ä»¥åœ¨å®¶è§‚å¯Ÿ

class SymptomAnalysis(BaseModel):
    possible_conditions: List[Dict]
    urgency: UrgencyLevel
    recommendations: List[str]
    see_doctor_urgency: str

class SymptomAnalyzer:
    def __init__(self):
        self.llm = ChatOpenAI(model="gpt-4", temperature=0)
        
        self.prompt = ChatPromptTemplate.from_messages([
            ("system", """ä½ æ˜¯ä¸€ä¸ªç—‡çŠ¶åˆ†æåŠ©æ‰‹ã€‚è¯·æ ¹æ®ç”¨æˆ·æè¿°çš„ç—‡çŠ¶è¿›è¡Œåˆ†æã€‚

é‡è¦è§„åˆ™ï¼š
1. åªæä¾›å¯èƒ½æ€§åˆ†æï¼Œä¸èƒ½è¯Šæ–­
2. ä¸¥é‡ç—‡çŠ¶å¿…é¡»æç¤ºç«‹å³å°±åŒ»
3. æä¾›æ—¶ç»™å‡ºå¯ä¿¡åº¦è¯„ä¼°
4. å§‹ç»ˆå»ºè®®å’¨è¯¢ä¸“ä¸šåŒ»ç”Ÿ

è¯·ä»¥JSONæ ¼å¼è¾“å‡ºï¼š
{
    "possible_conditions": [{"condition": "ç–¾ç—…å", "likelihood": "high/medium/low", "reason": "åŸå› "}],
    "urgency": "emergency/urgent/routine/self_care",
    "recommendations": ["å»ºè®®1", "å»ºè®®2"],
    "see_doctor_urgency": "å°±åŒ»ç´§æ€¥ç¨‹åº¦è¯´æ˜"
}"""),
            ("human", "ç—‡çŠ¶æè¿°ï¼š{symptoms}\næŒç»­æ—¶é—´ï¼š{duration}\nä¼´éšç—‡çŠ¶ï¼š{accompanying}")
        ])
        
        self.chain = self.prompt | self.llm
    
    def analyze(self, symptoms: str, duration: str = "æœªçŸ¥", 
                accompanying: str = "æ— ") -> SymptomAnalysis:
        result = self.chain.invoke({
            "symptoms": symptoms,
            "duration": duration,
            "accompanying": accompanying
        })
        
        # è§£æ JSONï¼ˆå®é™…ä½¿ç”¨ä¸­éœ€è¦æ›´å¥å£®çš„è§£æï¼‰
        import json
        try:
            data = json.loads(result.content)
            return SymptomAnalysis(**data)
        except:
            return SymptomAnalysis(
                possible_conditions=[],
                urgency=UrgencyLevel.ROUTINE,
                recommendations=["è¯·å’¨è¯¢ä¸“ä¸šåŒ»ç”Ÿ"],
                see_doctor_urgency="è¯·å’¨è¯¢åŒ»ç”Ÿè·å–å‡†ç¡®è¯Šæ–­"
            )

# ä½¿ç”¨
analyzer = SymptomAnalyzer()
result = analyzer.analyze(
    symptoms="å¤´ç—›",
    duration="2å¤©",
    accompanying="è½»å¾®å‘çƒ­ï¼Œä¹åŠ›"
)

print(f"ç´§æ€¥ç¨‹åº¦: {result.urgency.value}")
print("å¯èƒ½çš„çŠ¶å†µ:")
for condition in result.possible_conditions:
    print(f"  - {condition['condition']} (å¯ä¿¡åº¦: {condition['likelihood']})")
print("å»ºè®®:", result.recommendations)
print("å°±åŒ»å»ºè®®:", result.see_doctor_urgency)
```

### 3.2 ç—‡çŠ¶è¿½è¸ª

```python
from datetime import datetime, timedelta
from typing import Dict, List
import json

class SymptomTracker:
    def __init__(self, user_id: str):
        self.user_id = user_id
        self.symptoms: List[Dict] = []
    
    def log_symptom(self, symptom: str, severity: int, 
                    notes: str = "", medication: str = ""):
        """è®°å½•ç—‡çŠ¶"""
        self.symptoms.append({
            "timestamp": datetime.now().isoformat(),
            "symptom": symptom,
            "severity": severity,  # 1-10
            "notes": notes,
            "medication": medication
        })
    
    def get_symptom_summary(self) -> str:
        """ç”Ÿæˆç—‡çŠ¶æ‘˜è¦"""
        if not self.symptoms:
            return "æš‚æ— ç—‡çŠ¶è®°å½•"
        
        summary = "ğŸ“Š ç—‡çŠ¶æ‘˜è¦\n\n"
        
        # æŒ‰ç—‡çŠ¶ç±»å‹åˆ†ç»„
        symptom_types = {}
        for record in self.symptoms:
            s = record["symptom"]
            if s not in symptom_types:
                symptom_types[s] = []
            symptom_types[s].append(record)
        
        for symptom, records in symptom_types.items():
            avg_severity = sum(r["severity"] for r in records) / len(records)
            first_date = records[0]["timestamp"][:10]
            last_date = records[-1]["timestamp"][:10]
            
            summary += f"â€¢ {symptom}\n"
            summary += f"  è®°å½•æ¬¡æ•°: {len(records)}\n"
            summary += f"  å¹³å‡ä¸¥é‡ç¨‹åº¦: {avg_severity:.1f}/10\n"
            summary += f"  æŒç»­æ—¶é—´: {first_date} ~ {last_date}\n\n"
        
        return summary
    
    def export_for_doctor(self) -> str:
        """å¯¼å‡ºç»™åŒ»ç”Ÿçš„æŠ¥å‘Š"""
        if not self.symptoms:
            return "æš‚æ— ç—‡çŠ¶è®°å½•å¯å¯¼å‡º"
        
        report = "=" * 50 + "\n"
        report += "æ‚£è€…ç—‡çŠ¶è®°å½•æŠ¥å‘Š\n"
        report += f"æ‚£è€…ID: {self.user_id}\n"
        report += f"ç”Ÿæˆæ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M')}\n"
        report += "=" * 50 + "\n\n"
        
        report += self.get_symptom_summary()
        
        report += "\nè¯¦ç»†è®°å½•:\n"
        for i, record in enumerate(self.symptoms, 1):
            report += f"\n{i}. {record['timestamp'][:19]}\n"
            report += f"   ç—‡çŠ¶: {record['symptom']}\n"
            report += f"   ä¸¥é‡ç¨‹åº¦: {record['severity']}/10\n"
            if record['notes']:
                report += f"   å¤‡æ³¨: {record['notes']}\n"
            if record['medication']:
                report += f"   ç”¨è¯: {record['medication']}\n"
        
        return report

# ä½¿ç”¨
tracker = SymptomTracker("user_001")

# è®°å½•ç—‡çŠ¶
tracker.log_symptom("å¤´ç—›", 6, notes="å¯èƒ½æ˜¯ç¡çœ ä¸è¶³", medication="å¸ƒæ´›èŠ¬")
tracker.log_symptom("å¤´ç—›", 5, notes="è½»å¾®ç¼“è§£", medication="å¸ƒæ´›èŠ¬")
tracker.log_symptom("ç–²åŠ³", 4, notes="æœ€è¿‘å·¥ä½œå‹åŠ›å¤§")

print(tracker.get_symptom_summary())
print("=" * 50)
print(tracker.export_for_doctor())
```

## 4. è¯ç‰©åŠ©æ‰‹

### 4.1 ç”¨è¯å’¨è¯¢

```python
class MedicationAssistant:
    def __init__(self):
        self.llm = ChatOpenAI(model="gpt-4", temperature=0)
        
        # è¯ç‰©ä¿¡æ¯æ¨¡æ¿
        self.medication_prompt = ChatPromptTemplate.from_messages([
            ("system", """ä½ æ˜¯ä¸€ä½è¯ç‰©å’¨è¯¢åŠ©æ‰‹ã€‚è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
            
1. è¯ç‰©é€‚åº”ç—‡
2. ç”¨æ³•ç”¨é‡
3. æ³¨æ„äº‹é¡¹
4. ç¦å¿Œ
5. ä¸è‰¯ååº”

âš ï¸ é‡è¦å£°æ˜ï¼š
- è¿™åªæ˜¯è¯ç‰©ä¿¡æ¯å‚è€ƒï¼Œä¸èƒ½æ›¿ä»£åŒ»ç”Ÿå¤„æ–¹
- åŠ¡å¿…éµåŒ»å˜±ç”¨è¯
- å¦‚æœ‰ç–‘é—®ï¼Œè¯·å’¨è¯¢åŒ»ç”Ÿæˆ–è¯å¸ˆ"""),
            ("human", "è¯·ä»‹ç»ä»¥ä¸‹è¯ç‰©ï¼š{drug_name}")
        ])
        
        # ç”¨è¯æé†’æ¨¡æ¿
        self.reminder_prompt = ChatPromptTemplate.from_messages([
            ("system", "ä½ æ˜¯ä¸€ä¸ªç”¨è¯æé†’åŠ©æ‰‹ã€‚æ ¹æ®ç”¨æˆ·çš„ç”¨è¯è®¡åˆ’ï¼Œç”Ÿæˆæé†’å†…å®¹ã€‚"),
            ("human", "è¯ç‰©ï¼š{drug_name}\nå‰‚é‡ï¼š{dosage}\né¢‘ç‡ï¼š{frequency}\nå¼€å§‹æ—¥æœŸï¼š{start_date}\næŒç»­å¤©æ•°ï¼š{days}")
        ])
        
        self.medication_chain = self.medication_prompt | self.llm
        self.reminder_chain = self.reminder_prompt | self.llm
    
    def get_drug_info(self, drug_name: str) -> str:
        """è·å–è¯ç‰©ä¿¡æ¯"""
        return self.medication_chain.invoke({"drug_name": drug_name}).content
    
    def check_interactions(self, drugs: List[str]) -> str:
        """æ£€æŸ¥è¯ç‰©ç›¸äº’ä½œç”¨"""
        prompt = f"""è¯·åˆ†æä»¥ä¸‹è¯ç‰©ä¹‹é—´å¯èƒ½å­˜åœ¨çš„ç›¸äº’ä½œç”¨ï¼š
        
è¯ç‰©åˆ—è¡¨ï¼š{', '.join(drugs)}

è¯·åˆ—å‡ºå·²çŸ¥çš„ç›¸äº’ä½œç”¨å’Œæ³¨æ„äº‹é¡¹ã€‚"""
        
        return self.llm.invoke(prompt).content
    
    def generate_reminder(self, drug_name: str, dosage: str, 
                          frequency: str, start_date: str, days: int) -> str:
        """ç”Ÿæˆç”¨è¯æé†’"""
        return self.reminder_chain.invoke({
            "drug_name": drug_name,
            "dosage": dosage,
            "frequency": frequency,
            "start_date": start_date,
            "days": days
        }).content

# ä½¿ç”¨
med_assistant = MedicationAssistant()

# è¯ç‰©ä¿¡æ¯æŸ¥è¯¢
print(med_assistant.get_drug_info("å¸ƒæ´›èŠ¬"))
print("=" * 50)

# è¯ç‰©ç›¸äº’ä½œç”¨æ£€æŸ¥
print(med_assistant.check_interactions(["é˜¿å¸åŒ¹æ—", "å¸ƒæ´›èŠ¬", "åæ³•æ—"]))
```

### 4.2 æ™ºèƒ½ç”¨è¯æé†’

```python
from datetime import datetime, timedelta
from typing import List

class MedicationReminder:
    def __init__(self):
        self.reminders: List[dict] = []
    
    def add_reminder(self, drug_name: str, dosage: str, 
                     times: List[str], duration_days: int = 30):
        """æ·»åŠ ç”¨è¯æé†’"""
        reminder = {
            "drug_name": drug_name,
            "dosage": dosage,
            "times": times,
            "start_date": datetime.now(),
            "duration_days": duration_days,
            "enabled": True
        }
        self.reminders.append(reminder)
    
    def get_today_reminders(self) -> str:
        """è·å–ä»Šæ—¥æé†’"""
        today = datetime.now().strftime("%Y-%m-%d")
        message = f"ğŸ“… {today} ç”¨è¯æé†’\n\n"
        
        for i, rem in enumerate(self.reminders, 1):
            if not rem["enabled"]:
                continue
            
            message += f"{i}. ğŸ’Š {rem['drug_name']}\n"
            message += f"   å‰‚é‡: {rem['dosage']}\n"
            message += f"   æ—¶é—´: {', '.join(rem['times'])}\n\n"
        
        if message == f"ğŸ“… {today} ç”¨è¯æé†’\n\n":
            return "ä»Šå¤©æ²¡æœ‰ç”¨è¯æé†’"
        
        message += "\nâš ï¸ è¯·éµåŒ»å˜±ç”¨è¯"
        return message
    
    def generate_schedule(self, days: int = 7) -> str:
        """ç”Ÿæˆ_scheduleè¡¨"""
        schedule = "ğŸ“… ç”¨è¯è®¡åˆ’\n\n"
        
        for day in range(days):
            date = datetime.now() + timedelta(days=day)
            date_str = date.strftime("%Y-%m-%d (%A)")
            
            schedule += f"{date_str}\n"
            
            for rem in self.reminders:
                if not rem["enabled"]:
                    continue
                
                # æ£€æŸ¥æ˜¯å¦åœ¨æŒç»­æ—¶é—´å†…
                days_diff = (date.date() - rem["start_date"].date()).days
                if 0 <= days_diff < rem["duration_days"]:
                    schedule += f"  ğŸ’Š {rem['drug_name']} {rem['dosage']}"
                    schedule += f" - {', '.join(rem['times'])}\n"
            
            schedule += "\n"
        
        return schedule

# ä½¿ç”¨
reminder = MedicationReminder()

reminder.add_reminder(
    drug_name="é˜¿å¸åŒ¹æ—",
    dosage="1ç‰‡(100mg)",
    times=["08:00", "20:00"],
    duration_days=30
)

reminder.add_reminder(
    drug_name="ç»´ç”Ÿç´ D",
    dosage="1ç²’(400IU)",
    times=["08:00"],
    duration_days=90
)

print(reminder.get_today_reminders())
print("=" * 50)
print(reminder.generate_schedule(3))
```

## 5. åŒ»å­¦çŸ¥è¯†åº“ RAG

### 5.1 æ„å»ºåŒ»å­¦çŸ¥è¯†åº“

```python
from langchain.text_splitter import RecursiveCharacterTextSplitter
from langchain_community.vectorstores import Chroma
from langchain_openai import OpenAIEmbeddings
from langchain_community.document_loaders import TextLoader, PyPDFLoader

class MedicalKnowledgeBase:
    def __init__(self, persist_directory: str = "./medical_kb"):
        self.persist_directory = persist_directory
        self.embeddings = OpenAIEmbeddings()
        self.text_splitter = RecursiveCharacterTextSplitter(
            chunk_size=1000,
            chunk_overlap=100
        )
    
    def load_documents(self, file_paths: List[str]):
        """åŠ è½½æ–‡æ¡£"""
        documents = []
        
        for path in file_paths:
            if path.endswith('.txt'):
                loader = TextLoader(path)
            elif path.endswith('.pdf'):
                loader = PyPDFLoader(path)
            else:
                continue
            
            documents.extend(loader.load())
        
        return documents
    
    def build_knowledge_base(self, documents: List):
        """æ„å»ºçŸ¥è¯†åº“"""
        # åˆ†å‰²æ–‡æ¡£
        splits = self.text_splitter.split_documents(documents)
        
        # æ„å»ºå‘é‡æ•°æ®åº“
        vectorstore = Chroma.from_documents(
            documents=splits,
            embedding=self.embeddings,
            persist_directory=self.persist_directory
        )
        
        vectorstore.persist()
        
        return vectorstore.as_retriever(search_kwargs={"k": 3})
    
    def query(self, question: str, retriever) -> str:
        """æŸ¥è¯¢çŸ¥è¯†åº“"""
        # æ£€ç´¢ç›¸å…³æ–‡æ¡£
        docs = retriever.get_relevant_documents(question)
        
        context = "\n\n".join([doc.page_content for doc in docs])
        
        # ç”Ÿæˆå›ç­”
        prompt = f"""åŸºäºä»¥ä¸‹åŒ»å­¦çŸ¥è¯†åº“å†…å®¹å›ç­”é—®é¢˜ã€‚å¦‚æœçŸ¥è¯†åº“ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œè¯·è¯´æ˜ã€‚

çŸ¥è¯†åº“å†…å®¹ï¼š
{context}

é—®é¢˜ï¼š{question}

å›ç­”ï¼š"""
        
        from langchain_openai import ChatOpenAI
        llm = ChatOpenAI(model="gpt-4", temperature=0)
        
        return llm.invoke(prompt).content

# ä½¿ç”¨
# kb = MedicalKnowledgeBase()
# documents = kb.load_documents(["./medical_kb/diseases.txt", "./medical_kb/drugs.txt"])
# retriever = kb.build_knowledge_base(documents)
# answer = kb.query("ç³–å°¿ç—…çš„ç—‡çŠ¶æœ‰å“ªäº›ï¼Ÿ", retriever)
```

### 5.2 åŒ»ç–—é—®ç­” Chain

```python
from langchain_openai import ChatOpenAI
from langchain.prompts import ChatPromptTemplate

class MedicalQASystem:
    def __init__(self, retriever):
        self.llm = ChatOpenAI(model="gpt-4", temperature=0)
        self.retriever = retriever
        
        self.qa_prompt = ChatPromptTemplate.from_messages([
            ("system", """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„åŒ»å­¦çŸ¥è¯†é—®ç­”åŠ©æ‰‹ã€‚

è¦æ±‚ï¼š
1. åŸºäºæä¾›çš„åŒ»å­¦çŸ¥è¯†åº“å†…å®¹å›ç­”é—®é¢˜
2. ä½¿ç”¨é€šä¿—æ˜“æ‡‚çš„è¯­è¨€è§£é‡Šä¸“ä¸šåŒ»å­¦æœ¯è¯­
3. å›ç­”è¦å‡†ç¡®ã€å®¢è§‚
4. æ³¨æ˜ä¿¡æ¯æ¥æº
5. æé†’ç”¨æˆ·å’¨è¯¢ä¸“ä¸šåŒ»ç”Ÿ

âš ï¸ å…è´£å£°æ˜ï¼šæ­¤å›ç­”ä»…ä¾›å‚è€ƒï¼Œä¸èƒ½æ›¿ä»£åŒ»ç”Ÿè¯Šæ–­ã€‚"""),
            ("human", "çŸ¥è¯†åº“å†…å®¹ï¼š{context}\n\né—®é¢˜ï¼š{question}")
        ])
        
        self.chain = self.qa_prompt | self.llm
    
    def answer(self, question: str) -> str:
        # æ£€ç´¢ç›¸å…³çŸ¥è¯†
        docs = self.retriever.get_relevant_documents(question)
        context = "\n\n".join([doc.page_content for doc in docs])
        
        if not context:
            return "æŠ±æ­‰ï¼ŒçŸ¥è¯†åº“ä¸­æ²¡æœ‰æ‰¾åˆ°ç›¸å…³ä¿¡æ¯ã€‚å»ºè®®æ‚¨å’¨è¯¢ä¸“ä¸šåŒ»ç”Ÿã€‚"
        
        # ç”Ÿæˆå›ç­”
        response = self.chain.invoke({
            "context": context,
            "question": question
        })
        
        # æ·»åŠ å…è´£å£°æ˜
        response.content += "\n\nâš ï¸ æœ¬å›ç­”åŸºäºåŒ»å­¦çŸ¥è¯†åº“ï¼Œä»…ä¾›å‚è€ƒï¼Œä¸èƒ½æ›¿ä»£ä¸“ä¸šåŒ»ç–—è¯Šæ–­ã€‚"
        
        return response.content
```

## 6. å¥åº·æŠ¥å‘Šç”Ÿæˆ

### 6.1 å¥åº·æ‘˜è¦æŠ¥å‘Š

```python
from datetime import datetime
from typing import Dict, List

class HealthReportGenerator:
    def __init__(self):
        self.llm = ChatOpenAI(model="gpt-4", temperature=0.5)
    
    def generate_summary_report(self, 
                                symptoms: List[Dict],
                                medications: List[Dict],
                                vitals: Dict) -> str:
        """ç”Ÿæˆå¥åº·æ‘˜è¦æŠ¥å‘Š"""
        
        # æ„å»ºæ•°æ®æ‘˜è¦
        symptom_summary = self._summarize_symptoms(symptoms)
        medication_summary = self._summarize_medications(medications)
        vitals_summary = self._summarize_vitals(vitals)
        
        # ç”ŸæˆæŠ¥å‘Š
        prompt = f"""è¯·æ ¹æ®ä»¥ä¸‹å¥åº·æ•°æ®ç”Ÿæˆä¸€ä»½ä¸ªäººå¥åº·æ‘˜è¦æŠ¥å‘Šï¼š

{symptom_summary}

{medication_summary}

{vitals_summary}

è¦æ±‚ï¼š
1. æ€»ç»“æ•´ä½“å¥åº·çŠ¶å†µ
2. æé†’éœ€è¦æ³¨æ„çš„é—®é¢˜
3. ç»™å‡ºå¥åº·å»ºè®®
4. è¯­æ°”ä¸“ä¸šã€æ¸©å’Œ

âš ï¸ æ­¤æŠ¥å‘Šä»…ä¾›å‚è€ƒï¼Œä¸èƒ½æ›¿ä»£åŒ»ç”Ÿè¯Šæ–­ã€‚"""
        
        report = self.llm.invoke(prompt).content
        
        # æ·»åŠ æŠ¥å‘Šå¤´éƒ¨
        header = f"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    ä¸ªäººå¥åº·æ‘˜è¦æŠ¥å‘Š                          â•‘
â•‘                      {datetime.now().strftime('%Y-%m-%d')}                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

"""
        
        return header + report
    
    def _summarize_symptoms(self, symptoms: List[Dict]) -> str:
        if not symptoms:
            return "ğŸ“ ç—‡çŠ¶è®°å½•ï¼šæ— "
        
        summary = "ğŸ“ ç—‡çŠ¶è®°å½•ï¼š\n"
        for s in symptoms[-7:]:  # æœ€è¿‘7æ¡
            summary += f"  - {s.get('symptom', 'æœªçŸ¥')} (ä¸¥é‡ç¨‹åº¦: {s.get('severity', 'N/A')}/10)\n"
        return summary
    
    def _summarize_medications(self, medications: List[Dict]) -> str:
        if not medications:
            return "ğŸ’Š ç”¨è¯è®°å½•ï¼šæ— "
        
        summary = "ğŸ’Š å½“å‰ç”¨è¯ï¼š\n"
        for m in medications:
            summary += f"  - {m.get('drug', 'æœªçŸ¥')}: {m.get('dosage', 'N/A')}\n"
        return summary
    
    def _summarize_vitals(self, vitals: Dict) -> str:
        if not vitals:
            return "ğŸ“Š ç”Ÿå‘½ä½“å¾ï¼šæ— è®°å½•"
        
        summary = "ğŸ“Š ç”Ÿå‘½ä½“å¾ï¼š\n"
        for key, value in vitals.items():
            summary += f"  - {key}: {value}\n"
        return summary

# ä½¿ç”¨
generator = HealthReportGenerator()

symptoms = [
    {"symptom": "å¤´ç—›", "severity": 5, "date": "2024-01-15"},
    {"symptom": "ç–²åŠ³", "severity": 4, "date": "2024-01-14"},
    {"symptom": "å¤±çœ ", "severity": 6, "date": "2024-01-13"},
]

medications = [
    {"drug": "ç»´ç”Ÿç´ B", "dosage": "1ç‰‡/å¤©"},
    {"drug": "è¤ªé»‘ç´ ", "dosage": "1ç‰‡/ç¡å‰"},
]

vitals = {
    "è¡€å‹": "120/80 mmHg",
    "å¿ƒç‡": "72 bpm",
    "ä½“é‡": "70 kg",
    "ç¡çœ æ—¶é•¿": "6.5 å°æ—¶",
}

report = generator.generate_summary_report(symptoms, medications, vitals)
print(report)
```

## 7. éšç§ä¸å®‰å…¨

### 7.1 æ•°æ®è„±æ•

```python
import re

class DataAnonymizer:
    """åŒ»ç–—æ•°æ®è„±æ•"""
    
    # è„±æ•è§„åˆ™
    PATTERNS = {
        "phone": r"1[3-9]\d{9}",
        "id_card": r"\d{17}[\dXx]",
        "bank_card": r"\d{16,19}",
        "name": r"([å¼ æç‹åˆ˜é™ˆæ¨é»„èµµå‘¨å´å¾å­™é©¬æœ±èƒ¡éƒ­ä½•é«˜æ—ç½—éƒ‘æ¢è°¢å®‹å”è®¸éŸ©é‚“å†¯æ›¹å½­æ›¾è‚–ç”°è‘£è¢æ½˜äºè’‹è”¡ä½™æœå¶ç¨‹é­è‹å•ä¸ä»»æ²ˆ",
    }
    
    @classmethod
    def anonymize(cls, text: str) -> str:
        """è„±æ•å¤„ç†"""
        # æ‰‹æœºå·
        text = re.sub(cls.PATTERNS["phone"], "1**********", text)
        
        # èº«ä»½è¯å·
        text = re.sub(cls.PATTERNS["id_card"], "*******************", text)
        
        # é“¶è¡Œå¡
        text = re.sub(cls.PATTERNS["bank_card"], "****", text)
        
        return text
    
    @classmethod
    def extract_medical_info(cls, text: str) -> dict:
        """æå–éœ€è¦å…³æ³¨çš„åŒ»ç–—ä¿¡æ¯"""
        info = {
            "symptoms": [],
            "medications": [],
            "diseases": []
        }
        
        # ç—‡çŠ¶å…³é”®è¯
        symptom_keywords = ["ç–¼", "ç—›", "æ™•", "å", "æ³»", "å‘çƒ§", "å’³å—½"]
        for kw in symptom_keywords:
            if kw in text:
                info["symptoms"].append(kw)
        
        return info
```

## 8. æ€»ç»“

æœ¬ç« æˆ‘ä»¬ä»‹ç»äº†åŒ»ç–—å¥åº· AI ç³»ç»Ÿçš„æ„å»ºï¼š

1. **ç³»ç»Ÿæ¶æ„**ï¼šåˆ†å±‚è®¾è®¡ï¼ŒåŒ…å«ç”¨æˆ·äº¤äº’ã€å®‰å…¨ã€ä¸šåŠ¡ã€æ¨¡å‹ã€æ•°æ®å±‚
2. **åˆè§„æ€§è¦æ±‚**ï¼šè¾…åŠ©å†³ç­–ã€å…è´£å£°æ˜ã€éšç§ä¿æŠ¤
3. **å¥åº·å’¨è¯¢**ï¼šå¸¦å®‰å…¨æ£€æŸ¥çš„å¯¹è¯ç³»ç»Ÿ
4. **ç—‡çŠ¶åˆ†æ**ï¼šå¯èƒ½æ€§è¯„ä¼°ã€ç´§æ€¥ç¨‹åº¦åˆ¤æ–­
5. **è¯ç‰©åŠ©æ‰‹**ï¼šç”¨è¯å’¨è¯¢ã€ç›¸äº’ä½œç”¨æ£€æŸ¥ã€ç”¨è¯æé†’
6. **åŒ»å­¦çŸ¥è¯†åº“**ï¼šåŸºäº RAG çš„çŸ¥è¯†é—®ç­”
7. **å¥åº·æŠ¥å‘Š**ï¼šä¸ªäººå¥åº·æ‘˜è¦ç”Ÿæˆ
8. **éšç§å®‰å…¨**ï¼šæ•°æ®è„±æ•ã€å¤„ç†

âš ï¸ **é‡è¦æé†’**ï¼šåŒ»ç–— AI åº”ç”¨å¿…é¡»ä¸¥æ ¼éµå®ˆæ³•è§„ï¼Œæ˜ç¡® AI çš„è¾…åŠ©å®šä½ï¼Œä¸èƒ½æ›¿ä»£ä¸“ä¸šåŒ»ç–—è¯Šæ–­ã€‚
