# å®æˆ˜æ¡ˆä¾‹ï¼šä»é›¶æ„å»ºæ™ºèƒ½å®¢æœæœºå™¨äºº

> æœ¬æ–‡å°†å¸¦é¢†åˆå­¦è€…ä»é›¶å¼€å§‹ï¼Œä½¿ç”¨å¤§æ¨¡å‹ API æ„å»ºä¸€ä¸ªå®ç”¨çš„æ™ºèƒ½å®¢æœæœºå™¨äººã€‚

---

## ğŸ“‹ æ¡ˆä¾‹æ¦‚è¿°

### åœºæ™¯
ç”µå•†ç½‘ç«™éœ€è¦ä¸€ä¸ª 7Ã—24 å°æ—¶åœ¨çº¿çš„æ™ºèƒ½å®¢æœï¼Œèƒ½å¤Ÿï¼š
- å›ç­”å•†å“ç›¸å…³é—®é¢˜
- å¤„ç†é€€æ¢è´§å’¨è¯¢
- æä¾›è®¢å•æŸ¥è¯¢æŒ‡å¼•
- è½¬æ¥äººå·¥å®¢æœ

### æŠ€æœ¯æ ˆ
- **å¤§æ¨¡å‹**ï¼šGPT-4 / Claude / æ–‡å¿ƒä¸€è¨€ / é€šä¹‰åƒé—®
- **å¼€å‘è¯­è¨€**ï¼šPython 3.8+
- **æ¡†æ¶**ï¼šOpenAI API / LangChain
- **éƒ¨ç½²**ï¼šFlask + Docker

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·ç•Œé¢      â”‚â”€â”€â”€â”€â–¶â”‚  åç«¯æœåŠ¡    â”‚â”€â”€â”€â”€â–¶â”‚  å¤§æ¨¡å‹ API â”‚
â”‚  (Web/å°ç¨‹åº)   â”‚     â”‚   (Flask)    â”‚     â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  çŸ¥è¯†åº“/RAG  â”‚
                        â”‚  (å‘é‡æ•°æ®åº“) â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒå‡†å¤‡

### 1.1 å®‰è£…ä¾èµ–

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate   # Windows

# å®‰è£…ä¾èµ–åŒ…
pip install openai flask flask-cors python-dotenv
```

### 1.2 é…ç½® API å¯†é’¥

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
# OpenAI / Azure OpenAI
OPENAI_API_KEY=your_api_key_here
OPENAI_BASE_URL=https://api.openai.com/v1

# æˆ–è€…ä½¿ç”¨å›½äº§å¤§æ¨¡å‹
# æ™ºè°± AI
ZHIPU_API_KEY=your_zhipu_key

# é€šä¹‰åƒé—®
DASHSCOPE_API_KEY=your_dashscope_key
```

---

## ğŸ“ ç¬¬äºŒæ­¥ï¼šåŸºç¡€å¯¹è¯åŠŸèƒ½

### 2.1 æœ€ç®€å•çš„å®¢æœæœºå™¨äºº

```python
# customer_service.py
import os
from openai import OpenAI
from dotenv import load_dotenv

load_dotenv()

client = OpenAI(
    api_key=os.getenv("OPENAI_API_KEY"),
    base_url=os.getenv("OPENAI_BASE_URL")
)

# å®¢æœç³»ç»Ÿæç¤ºè¯
SYSTEM_PROMPT = """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„ç”µå•†å®¢æœåŠ©æ‰‹ï¼Œåä¸º"å°æ™º"ã€‚

ä½ çš„èŒè´£ï¼š
1. çƒ­æƒ…å‹å¥½åœ°å›ç­”ç”¨æˆ·å…³äºå•†å“çš„å’¨è¯¢
2. æŒ‡å¯¼ç”¨æˆ·è¿›è¡Œè®¢å•æŸ¥è¯¢ã€é€€æ¢è´§æ“ä½œ
3. å¯¹äºå¤æ‚é—®é¢˜ï¼Œå»ºè®®è½¬æ¥äººå·¥å®¢æœ
4. ç»ä¸æ‰¿è¯ºæ— æ³•å®ç°çš„æœåŠ¡

å•†å“ä¿¡æ¯ï¼š
- ä¸»è¥ï¼šæ•°ç äº§å“ã€æ™ºèƒ½å®¶å±…
- å”®åæ”¿ç­–ï¼š7å¤©æ— ç†ç”±é€€æ¢ï¼Œ30å¤©è´¨é‡é—®é¢˜åŒ…æ¢
- å®¢æœæ—¶é—´ï¼šäººå·¥å®¢æœ 9:00-21:00

æ³¨æ„äº‹é¡¹ï¼š
- å›ç­”ç®€æ´æ˜äº†ï¼Œæ§åˆ¶åœ¨100å­—ä»¥å†…
- æ¶‰åŠå…·ä½“è®¢å•æ—¶ï¼Œå¼•å¯¼ç”¨æˆ·ç™»å½•è´¦æˆ·æŸ¥çœ‹
- é‡åˆ°æŠ•è¯‰æ—¶å…ˆå®‰æŠšæƒ…ç»ª
"""

def chat_with_customer(user_message: str, conversation_history: list = None):
    """
    ä¸é¡¾å®¢å¯¹è¯
    
    Args:
        user_message: ç”¨æˆ·æ¶ˆæ¯
        conversation_history: å†å²å¯¹è¯è®°å½•
    
    Returns:
        AI å›å¤å†…å®¹
    """
    messages = [{"role": "system", "content": SYSTEM_PROMPT}]
    
    # æ·»åŠ å†å²è®°å½•
    if conversation_history:
        messages.extend(conversation_history)
    
    # æ·»åŠ ç”¨æˆ·æ–°æ¶ˆæ¯
    messages.append({"role": "user", "content": user_message})
    
    # è°ƒç”¨ API
    response = client.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=messages,
        temperature=0.7,
        max_tokens=200
    )
    
    return response.choices[0].message.content

# æµ‹è¯•
if __name__ == "__main__":
    print("ğŸ¤– å°æ™ºå®¢æœä¸Šçº¿ï¼è¾“å…¥ 'quit' é€€å‡º\n")
    history = []
    
    while True:
        user_input = input("é¡¾å®¢: ")
        if user_input.lower() == 'quit':
            break
        
        reply = chat_with_customer(user_input, history)
        print(f"å°æ™º: {reply}\n")
        
        # ä¿å­˜å¯¹è¯å†å²
        history.append({"role": "user", "content": user_input})
        history.append({"role": "assistant", "content": reply})
```

### 2.2 è¿è¡Œæµ‹è¯•

```bash
python customer_service.py
```

**ç¤ºä¾‹å¯¹è¯ï¼š**

```
é¡¾å®¢: ä½ å¥½ï¼Œæˆ‘æƒ³ä¹°ä¸€å°ç¬”è®°æœ¬ç”µè„‘
å°æ™º: æ‚¨å¥½ï¼æ¬¢è¿å’¨è¯¢ã€‚æˆ‘ä»¬æœ‰å¤šç§ç¬”è®°æœ¬å¯é€‰ï¼ŒåŒ…æ‹¬è½»è–„æœ¬ã€æ¸¸æˆæœ¬ç­‰ã€‚è¯·é—®æ‚¨ä¸»è¦ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿé¢„ç®—èŒƒå›´å¤§æ¦‚æ˜¯å¤šå°‘å‘¢ï¼Ÿæˆ‘å¯ä»¥ä¸ºæ‚¨æ¨èåˆé€‚çš„å‹å·~ ğŸ–¥ï¸

é¡¾å®¢: æˆ‘æƒ³é€€è´§æ€ä¹ˆæ“ä½œï¼Ÿ
å°æ™º: æ‚¨å¥½ï¼æˆ‘ä»¬æ”¯æŒ7å¤©æ— ç†ç”±é€€æ¢è´§ã€‚è¯·ç™»å½•æ‚¨çš„è´¦æˆ·ï¼Œåœ¨"æˆ‘çš„è®¢å•"ä¸­æ‰¾åˆ°å¯¹åº”å•†å“ï¼Œç‚¹å‡»"ç”³è¯·å”®å"å³å¯ã€‚å¦‚éœ€å¸®åŠ©ï¼Œæˆ‘å¯ä»¥ä¸ºæ‚¨è½¬æ¥äººå·¥å®¢æœ ğŸ“¦
```

---

## ğŸ¯ ç¬¬ä¸‰æ­¥ï¼šæ„å›¾è¯†åˆ«ä¸è·¯ç”±

### 3.1 ä¸ºä»€ä¹ˆéœ€è¦æ„å›¾è¯†åˆ«ï¼Ÿ

å½“ç”¨æˆ·è¯´"æˆ‘ä¹°çš„æ‰‹æœºåäº†"ï¼Œç³»ç»Ÿéœ€è¦åˆ¤æ–­ï¼š
- ğŸ”§ æŠ€æœ¯é—®é¢˜ â†’ æä¾›æ•…éšœæ’æŸ¥
- ğŸ“¦ é€€æ¢è´§ â†’ å¼•å¯¼å”®åæµç¨‹
- ğŸ˜  æŠ•è¯‰ â†’ å®‰æŠšæƒ…ç»ªå¹¶å‡çº§

### 3.2 å®ç°æ„å›¾åˆ†ç±»

```python
# intent_classifier.py
import json
from openai import OpenAI
import os

client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))

# å®šä¹‰æ„å›¾ç±»åˆ«
INTENTS = {
    "product_inquiry": "å•†å“å’¨è¯¢",
    "order_query": "è®¢å•æŸ¥è¯¢", 
    "refund_return": "é€€æ¢è´§",
    "complaint": "æŠ•è¯‰å»ºè®®",
    "technical_issue": "æŠ€æœ¯é—®é¢˜",
    "human_transfer": "è½¬äººå·¥",
    "other": "å…¶ä»–"
}

def classify_intent(user_message: str) -> dict:
    """
    è¯†åˆ«ç”¨æˆ·æ„å›¾
    
    Returns:
        {
            "intent": "æ„å›¾ç±»åˆ«",
            "confidence": ç½®ä¿¡åº¦(0-1),
            "entities": {"key": "value"}  # æå–çš„å®ä½“
        }
    """
    prompt = f"""åˆ†æç”¨æˆ·æ¶ˆæ¯ï¼Œè¯†åˆ«æ„å›¾å¹¶æå–å…³é”®ä¿¡æ¯ã€‚

ç”¨æˆ·æ¶ˆæ¯ï¼š"{user_message}"

å¯é€‰æ„å›¾ï¼š
- product_inquiry: è¯¢é—®å•†å“ä»·æ ¼ã€åŠŸèƒ½ã€åº“å­˜ç­‰
- order_query: æŸ¥è¯¢è®¢å•çŠ¶æ€ã€ç‰©æµä¿¡æ¯
- refund_return: é€€è´§ã€æ¢è´§ã€é€€æ¬¾
- complaint: æŠ•è¯‰ã€ä¸æ»¡ã€è´Ÿé¢åé¦ˆ
- technical_issue: äº§å“ä½¿ç”¨é—®é¢˜ã€æ•…éšœ
- human_transfer: æ˜ç¡®è¦æ±‚äººå·¥å®¢æœ
- other: å…¶ä»–

è¯·ä»¥JSONæ ¼å¼è¿”å›ï¼š
{{
    "intent": "æ„å›¾ä»£ç ",
    "confidence": 0.95,
    "entities": {{
        "product_name": "å•†å“åç§°ï¼ˆå¦‚æœ‰ï¼‰",
        "order_id": "è®¢å•å·ï¼ˆå¦‚æœ‰ï¼‰",
        "issue_type": "é—®é¢˜ç±»å‹"
    }},
    "response_strategy": "å›å¤ç­–ç•¥å»ºè®®"
}}"""

    response = client.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=[
            {"role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªæ„å›¾è¯†åˆ«ä¸“å®¶ï¼Œåªè¾“å‡ºJSONæ ¼å¼ç»“æœã€‚"},
            {"role": "user", "content": prompt}
        ],
        temperature=0.1,  # ä½æ¸©åº¦ï¼Œæ›´ç¡®å®šæ€§çš„è¾“å‡º
        max_tokens=300
    )
    
    try:
        result = json.loads(response.choices[0].message.content)
        return result
    except json.JSONDecodeError:
        return {
            "intent": "other",
            "confidence": 0.5,
            "entities": {},
            "response_strategy": "é»˜è®¤å›å¤"
        }

# æµ‹è¯•æ„å›¾è¯†åˆ«
if __name__ == "__main__":
    test_messages = [
        "æˆ‘æ˜¨å¤©ä¹°çš„iPhoneä»€ä¹ˆæ—¶å€™åˆ°è´§ï¼Ÿ",
        "è¿™ä¸ªç”µè„‘é…ç½®èƒ½ç©3Aæ¸¸æˆå—ï¼Ÿ",
        "ä½ ä»¬è¿™æ˜¯ä»€ä¹ˆåƒåœ¾æœåŠ¡ï¼",
        "æˆ‘è¦é€€è´§ï¼Œæ€ä¹ˆæ“ä½œï¼Ÿ",
        "æ‰‹æœºå……ä¸è¿›ç”µäº†æ€ä¹ˆåŠï¼Ÿ",
        "æˆ‘è¦æ‰¾äººå·¥å®¢æœ"
    ]
    
    for msg in test_messages:
        result = classify_intent(msg)
        intent_name = INTENTS.get(result['intent'], 'æœªçŸ¥')
        print(f"ğŸ“ {msg}")
        print(f"   æ„å›¾: {intent_name} (ç½®ä¿¡åº¦: {result['confidence']:.2f})")
        print(f"   å®ä½“: {result['entities']}")
        print(f"   ç­–ç•¥: {result['response_strategy']}\n")
```

### 3.3 åŸºäºæ„å›¾çš„å›å¤ç­–ç•¥

```python
# smart_customer_service.py
from customer_service import chat_with_customer, SYSTEM_PROMPT
from intent_classifier import classify_intent, INTENTS

# é’ˆå¯¹ä¸åŒæ„å›¾çš„ç³»ç»Ÿæç¤ºè¯
INTENT_PROMPTS = {
    "product_inquiry": """ä¸“æ³¨äºå•†å“ä»‹ç»ï¼š
- çªå‡ºäº§å“ä¼˜åŠ¿å’Œé€‚ç”¨åœºæ™¯
- å¯¹æ¯”ç›¸ä¼¼äº§å“çš„å·®å¼‚
- æä¾›é€‰è´­å»ºè®®
- æåŠå½“å‰ä¼˜æƒ æ´»åŠ¨""",
    
    "order_query": """ä¸“æ³¨äºè®¢å•æœåŠ¡ï¼š
- å¼•å¯¼ç”¨æˆ·ç™»å½•è´¦æˆ·æŸ¥è¯¢
- è§£é‡Šç‰©æµçŠ¶æ€çš„å«ä¹‰
- æä¾›å®˜æ–¹æŸ¥è¯¢æ¸ é“
- å¼‚å¸¸æƒ…å†µè®°å½•å¹¶è·Ÿè¿›""",
    
    "refund_return": """ä¸“æ³¨äºå”®åæµç¨‹ï¼š
- è¯´æ˜é€€æ¢è´§æ”¿ç­–å’Œæ¡ä»¶
- åˆ†æ­¥éª¤æŒ‡å¯¼æ“ä½œæµç¨‹
- å‘ŠçŸ¥é€€æ¬¾æ—¶æ•ˆ
- æä¾›é€€æ¢è´§åœ°å€""",
    
    "complaint": """ä¸“æ³¨äºå®‰æŠšå’Œè§£å†³ï¼š
- é¦–å…ˆçœŸè¯šé“æ­‰å¹¶å®‰æŠšæƒ…ç»ª
- è¡¨ç¤ºç†è§£å’Œé‡è§†
- æä¾›å…·ä½“çš„è§£å†³æ–¹æ¡ˆæˆ–è¡¥å¿
- å¿…è¦æ—¶æ‰¿è¯ºä¸“äººè·Ÿè¿›""",
    
    "technical_issue": """ä¸“æ³¨äºæŠ€æœ¯æ”¯æŒï¼š
- æä¾›å¸¸è§é—®é¢˜çš„æ’æŸ¥æ­¥éª¤
- ç»™å‡ºå…·ä½“çš„æ“ä½œæŒ‡å¯¼
- å»ºè®®é‡ç½®ã€æ›´æ–°ç­‰æ“ä½œ
- æ— æ³•è§£å†³æ—¶å»ºè®®è”ç³»å”®å""",
    
    "human_transfer": """ä¸“æ³¨äºè½¬æ¥æœåŠ¡ï¼š
- ç¡®è®¤è½¬æ¥æ„æ„¿
- å‘ŠçŸ¥ç­‰å¾…æ—¶é—´
- æ”¶é›†é—®é¢˜æ‘˜è¦ä¾¿äºäººå·¥æ¥æ‰‹
- ç¤¼è²Œç»“æŸAIå¯¹è¯"""
}

def smart_reply(user_message: str, history: list = None) -> dict:
    """
    æ™ºèƒ½å›å¤ï¼šå…ˆè¯†åˆ«æ„å›¾ï¼Œå†ç”Ÿæˆé’ˆå¯¹æ€§å›å¤
    """
    # ç¬¬ä¸€æ­¥ï¼šæ„å›¾è¯†åˆ«
    intent_result = classify_intent(user_message)
    intent = intent_result['intent']
    
    # ç¬¬äºŒæ­¥ï¼šæ„å»ºå¢å¼ºçš„ç³»ç»Ÿæç¤ºè¯
    base_prompt = SYSTEM_PROMPT
    if intent in INTENT_PROMPTS:
        base_prompt += f"\n\nã€å½“å‰åœºæ™¯ã€‘\n{INTENT_PROMPTS[intent]}"
    
    # ç¬¬ä¸‰æ­¥ï¼šç”Ÿæˆå›å¤
    messages = [{"role": "system", "content": base_prompt}]
    if history:
        messages.extend(history)
    messages.append({"role": "user", "content": user_message})
    
    response = client.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=messages,
        temperature=0.7,
        max_tokens=250
    )
    
    return {
        "reply": response.choices[0].message.content,
        "intent": intent,
        "intent_name": INTENTS.get(intent, "æœªçŸ¥"),
        "confidence": intent_result['confidence'],
        "entities": intent_result['entities']
    }

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    print("ğŸ¤– æ™ºèƒ½å®¢æœå°æ™ºä¸Šçº¿ï¼\n")
    
    user_msg = "æˆ‘ä¹°çš„æ‰‹æœºå……ä¸è¿›ç”µï¼Œæ°”æ­»æˆ‘äº†ï¼"
    result = smart_reply(user_msg)
    
    print(f"ç”¨æˆ·: {user_msg}")
    print(f"è¯†åˆ«æ„å›¾: {result['intent_name']} (ç½®ä¿¡åº¦: {result['confidence']:.2f})")
    print(f"æå–å®ä½“: {result['entities']}")
    print(f"\nå°æ™º: {result['reply']}")
```

---

## ğŸ’¾ ç¬¬å››æ­¥ï¼šæ·»åŠ è®°å¿†åŠŸèƒ½

### 4.1 ä¸ºä»€ä¹ˆè¦è®°å¿†ï¼Ÿ

ç”¨æˆ·å¯¹è¯é€šå¸¸æ˜¯è¿ç»­çš„ï¼š
- ç”¨æˆ·ï¼š"æˆ‘æƒ³ä¹°æ‰‹æœº"
- ç”¨æˆ·ï¼š"å“ªæ¬¾ç»­èˆªå¥½ï¼Ÿ" â† æŒ‡çš„æ˜¯æ‰‹æœº
- ç”¨æˆ·ï¼š"å¤šå°‘é’±ï¼Ÿ" â† è¿˜æ˜¯æŒ‡é‚£æ¬¾æ‰‹æœº

### 4.2 ç®€å•å†…å­˜å­˜å‚¨

```python
# conversation_memory.py
from datetime import datetime

class ConversationMemory:
    """å¯¹è¯è®°å¿†ç®¡ç†"""
    
    def __init__(self, max_history=10):
        self.sessions = {}  # session_id -> conversation
        self.max_history = max_history
    
    def add_message(self, session_id: str, role: str, content: str):
        """æ·»åŠ ä¸€æ¡æ¶ˆæ¯"""
        if session_id not in self.sessions:
            self.sessions[session_id] = {
                "messages": [],
                "created_at": datetime.now(),
                "context": {}  # å­˜å‚¨æå–çš„ä¿¡æ¯
            }
        
        self.sessions[session_id]["messages"].append({
            "role": role,
            "content": content,
            "timestamp": datetime.now()
        })
        
        # é™åˆ¶å†å²é•¿åº¦
        if len(self.sessions[session_id]["messages"]) > self.max_history:
            self.sessions[session_id]["messages"] = \
                self.sessions[session_id]["messages"][-self.max_history:]
    
    def get_history(self, session_id: str) -> list:
        """è·å–å¯¹è¯å†å²"""
        if session_id not in self.sessions:
            return []
        return self.sessions[session_id]["messages"]
    
    def update_context(self, session_id: str, key: str, value: any):
        """æ›´æ–°ä¸Šä¸‹æ–‡ä¿¡æ¯"""
        if session_id in self.sessions:
            self.sessions[session_id]["context"][key] = value
    
    def get_context(self, session_id: str, key: str = None):
        """è·å–ä¸Šä¸‹æ–‡ä¿¡æ¯"""
        if session_id not in self.sessions:
            return None
        if key:
            return self.sessions[session_id]["context"].get(key)
        return self.sessions[session_id]["context"]
    
    def generate_summary(self, session_id: str) -> str:
        """ç”Ÿæˆå¯¹è¯æ‘˜è¦"""
        context = self.get_context(session_id)
        history = self.get_history(session_id)
        
        summary_parts = []
        if context.get("product"):
            summary_parts.append(f"å’¨è¯¢å•†å“: {context['product']}")
        if context.get("intent"):
            summary_parts.append(f"ä¸»è¦æ„å›¾: {context['intent']}")
        if context.get("issue"):
            summary_parts.append(f"é—®é¢˜: {context['issue']}")
        
        return " | ".join(summary_parts) if summary_parts else "æ–°ä¼šè¯"

# ä½¿ç”¨ç¤ºä¾‹
memory = ConversationMemory()

session_id = "user_123"
memory.add_message(session_id, "user", "æˆ‘æƒ³ä¹°ä¸€å°ç¬”è®°æœ¬ç”µè„‘")
memory.add_message(session_id, "assistant", "å¥½çš„ï¼Œè¯·é—®æ‚¨ä¸»è¦ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ")
memory.update_context(session_id, "product", "ç¬”è®°æœ¬ç”µè„‘")
memory.update_context(session_id, "intent", "product_inquiry")

print("å¯¹è¯å†å²:", memory.get_history(session_id))
print("ä¸Šä¸‹æ–‡:", memory.get_context(session_id))
print("æ‘˜è¦:", memory.generate_summary(session_id))
```

---

## ğŸŒ ç¬¬äº”æ­¥ï¼šWeb æœåŠ¡éƒ¨ç½²

### 5.1 Flask API æœåŠ¡

```python
# app.py
from flask import Flask, request, jsonify
from flask_cors import CORS
from smart_customer_service import smart_reply
from conversation_memory import ConversationMemory
import uuid

app = Flask(__name__)
CORS(app)  # å…è®¸è·¨åŸŸ

# åˆå§‹åŒ–å†…å­˜
memory = ConversationMemory()

@app.route('/chat', methods=['POST'])
def chat():
    """
    å®¢æœå¯¹è¯æ¥å£
    
    Request:
        {
            "message": "ç”¨æˆ·æ¶ˆæ¯",
            "session_id": "å¯é€‰ï¼Œä¸ä¼ åˆ™æ–°å»ºä¼šè¯"
        }
    
    Response:
        {
            "reply": "AIå›å¤",
            "session_id": "ä¼šè¯ID",
            "intent": "è¯†åˆ«çš„æ„å›¾",
            "confidence": 0.95
        }
    """
    data = request.json
    user_message = data.get('message', '')
    session_id = data.get('session_id') or str(uuid.uuid4())
    
    # è·å–å†å²è®°å½•
    history = memory.get_history(session_id)
    
    # ç”Ÿæˆå›å¤
    result = smart_reply(user_message, history)
    
    # ä¿å­˜åˆ°å†…å­˜
    memory.add_message(session_id, "user", user_message)
    memory.add_message(session_id, "assistant", result['reply'])
    memory.update_context(session_id, "last_intent", result['intent'])
    
    return jsonify({
        "reply": result['reply'],
        "session_id": session_id,
        "intent": result['intent_name'],
        "confidence": result['confidence'],
        "entities": result['entities']
    })

@app.route('/history/<session_id>', methods=['GET'])
def get_history(session_id):
    """è·å–å¯¹è¯å†å²"""
    history = memory.get_history(session_id)
    context = memory.get_context(session_id)
    
    return jsonify({
        "session_id": session_id,
        "messages": history,
        "context": context
    })

@app.route('/health', methods=['GET'])
def health_check():
    """å¥åº·æ£€æŸ¥"""
    return jsonify({"status": "ok", "service": "customer-service-bot"})

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000, debug=True)
```

### 5.2 å¯åŠ¨æœåŠ¡

```bash
python app.py
```

### 5.3 æµ‹è¯• API

```bash
# å‘é€æ¶ˆæ¯
curl -X POST http://localhost:5000/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "ä½ å¥½ï¼Œæˆ‘æƒ³ä¹°ä¸€å°ç¬”è®°æœ¬ç”µè„‘"
  }'

# ç»§ç»­å¯¹è¯ï¼ˆå¸¦ä¸Š session_idï¼‰
curl -X POST http://localhost:5000/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "ä¸»è¦ç”¨äºç¼–ç¨‹å¼€å‘",
    "session_id": "è¿”å›çš„session_id"
  }'
```

---

## ğŸ“š ç¬¬å…­æ­¥ï¼šå‰ç«¯ç•Œé¢ï¼ˆå¯é€‰ï¼‰

### 6.1 ç®€å• HTML èŠå¤©ç•Œé¢

```html
<!-- chat.html -->
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½å®¢æœ - å°æ™º</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .chat-container {
            width: 100%;
            max-width: 480px;
            height: 80vh;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }
        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 16px 16px 0 0;
        }
        .chat-header h1 { font-size: 18px; }
        .chat-header p { font-size: 12px; opacity: 0.8; margin-top: 4px; }
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        .message {
            margin-bottom: 16px;
            display: flex;
            align-items: flex-start;
        }
        .message.user { flex-direction: row-reverse; }
        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 16px;
            font-size: 14px;
            line-height: 1.5;
        }
        .message.bot .message-content {
            background: #f0f0f0;
            color: #333;
            border-bottom-left-radius: 4px;
        }
        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 4px;
        }
        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            margin: 0 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        .message.bot .avatar { background: #e0e0e0; }
        .message.user .avatar { background: #667eea; }
        .chat-input {
            padding: 16px 20px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 12px;
        }
        .chat-input input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 24px;
            outline: none;
            font-size: 14px;
        }
        .chat-input button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 24px;
            cursor: pointer;
            font-size: 14px;
        }
        .chat-input button:hover { opacity: 0.9; }
        .typing { font-style: italic; color: #999; }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>ğŸ¤– æ™ºèƒ½å®¢æœå°æ™º</h1>
            <p>7Ã—24å°æ—¶åœ¨çº¿ä¸ºæ‚¨æœåŠ¡</p>
        </div>
        <div class="chat-messages" id="messages">
            <div class="message bot">
                <div class="avatar">ğŸ¤–</div>
                <div class="message-content">
                    æ‚¨å¥½ï¼æˆ‘æ˜¯æ™ºèƒ½å®¢æœå°æ™ºï¼Œè¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„ï¼Ÿ
                </div>
            </div>
        </div>
        <div class="chat-input">
            <input type="text" id="userInput" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..." onkeypress="handleEnter(event)">
            <button onclick="sendMessage()">å‘é€</button>
        </div>
    </div>

    <script>
        let sessionId = null;
        const API_URL = 'http://localhost:5000/chat';

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            if (!message) return;

            // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
            addMessage(message, 'user');
            input.value = '';

            // æ˜¾ç¤ºæ­£åœ¨è¾“å…¥
            const typingId = addTyping();

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message, session_id: sessionId })
                });
                const data = await response.json();
                
                // ä¿å­˜ session_id
                sessionId = data.session_id;
                
                // ç§»é™¤æ­£åœ¨è¾“å…¥ï¼Œæ˜¾ç¤ºå›å¤
                removeTyping(typingId);
                addMessage(data.reply, 'bot');
            } catch (error) {
                removeTyping(typingId);
                addMessage('æŠ±æ­‰ï¼ŒæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚', 'bot');
            }
        }

        function addMessage(text, sender) {
            const messages = document.getElementById('messages');
            const div = document.createElement('div');
            div.className = `message ${sender}`;
            div.innerHTML = `
                <div class="avatar">${sender === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–'}</div>
                <div class="message-content">${text}</div>
            `;
            messages.appendChild(div);
            messages.scrollTop = messages.scrollHeight;
        }

        function addTyping() {
            const messages = document.getElementById('messages');
            const id = 'typing-' + Date.now();
            const div = document.createElement('div');
            div.id = id;
            div.className = 'message bot';
            div.innerHTML = `
                <div class="avatar">ğŸ¤–</div>
                <div class="message-content typing">æ­£åœ¨è¾“å…¥...</div>
            `;
            messages.appendChild(div);
            messages.scrollTop = messages.scrollHeight;
            return id;
        }

        function removeTyping(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }

        function handleEnter(event) {
            if (event.key === 'Enter') sendMessage();
        }
    </script>
</body>
</html>
```

---

## ğŸ¯ æ€»ç»“ä¸æ‰©å±•

### æœ¬æ¡ˆä¾‹å­¦åˆ°ä»€ä¹ˆï¼Ÿ

1. âœ… **åŸºç¡€å¯¹è¯**ï¼šä½¿ç”¨ OpenAI API å®ç°å®¢æœå¯¹è¯
2. âœ… **æ„å›¾è¯†åˆ«**ï¼šè®©æœºå™¨äºº"ç†è§£"ç”¨æˆ·éœ€æ±‚
3. âœ… **è®°å¿†åŠŸèƒ½**ï¼šç»´æŠ¤å¯¹è¯ä¸Šä¸‹æ–‡
4. âœ… **Web éƒ¨ç½²**ï¼šå°†æœºå™¨äººå‘å¸ƒä¸º API æœåŠ¡
5. âœ… **å‰ç«¯ç•Œé¢**ï¼šæä¾›å‹å¥½çš„ç”¨æˆ·äº¤äº’

### è¿›é˜¶ä¼˜åŒ–æ–¹å‘

```
ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–
â”œâ”€â”€ ä½¿ç”¨ Redis æ›¿ä»£å†…å­˜å­˜å‚¨ï¼Œæ”¯æŒåˆ†å¸ƒå¼
â”œâ”€â”€ æ·»åŠ å¯¹è¯ç¼“å­˜ï¼Œå‡å°‘ API è°ƒç”¨
â””â”€â”€ å®ç°æµå¼å“åº”ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

ğŸ§  æ™ºèƒ½å¢å¼º
â”œâ”€â”€ æ¥å…¥ RAGï¼ŒåŸºäºäº§å“çŸ¥è¯†åº“å›ç­”
â”œâ”€â”€ å®ç°å¤šè½®å¯¹è¯å¼•å¯¼
â””â”€â”€ æ·»åŠ æƒ…æ„Ÿåˆ†æï¼Œè¯†åˆ«ç”¨æˆ·æƒ…ç»ª

ğŸ”’ å®‰å…¨ä¸ç›‘æ§
â”œâ”€â”€ æ·»åŠ è¾“å…¥è¿‡æ»¤ï¼Œé˜²æ­¢ Prompt æ³¨å…¥
â”œâ”€â”€ è®°å½•å¯¹è¯æ—¥å¿—ï¼Œä¾¿äºåˆ†æ
â””â”€â”€ å®ç°é™æµï¼Œé˜²æ­¢ API æ»¥ç”¨

ğŸš€ ç”Ÿäº§éƒ¨ç½²
â”œâ”€â”€ Docker å®¹å™¨åŒ–
â”œâ”€â”€ ä½¿ç”¨ Nginx åå‘ä»£ç†
â””â”€â”€ é…ç½® SSL è¯ä¹¦
```

---

## ğŸ“– å‚è€ƒèµ„æº

- [OpenAI API æ–‡æ¡£](https://platform.openai.com/docs)
- [LangChain å®˜æ–¹æ–‡æ¡£](https://python.langchain.com/)
- [Flask å®˜æ–¹æ–‡æ¡£](https://flask.palletsprojects.com/)

---

**ä½œè€…**ï¼šå¤§ç™½  
**æ›´æ–°æ—¥æœŸ**ï¼š2026-02-14  
**éš¾åº¦**ï¼šâ­â­â­ åˆçº§åˆ°ä¸­çº§
